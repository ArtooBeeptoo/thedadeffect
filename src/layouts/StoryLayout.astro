---
import BaseLayout from './BaseLayout.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  story: CollectionEntry<'stories'>;
}

const { story } = Astro.props;
const { title, description, pubDate, categories, tags } = story.data;

function readingTime(text: string): number {
  return Math.ceil(text.split(/\s+/).length / 200);
}
---

<BaseLayout title={title} description={description}>
  <div class="container">
    <article class="single-story">
      <header class="story-header">
        <div class="story-meta">
          <time datetime={pubDate.toISOString()}>
            {pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </time>
          {categories.map((cat: string) => (
            <span class="category">{cat}</span>
          ))}
          <span class="reading-time">{readingTime(story.body || '')} min read</span>
        </div>
        <h1>{title}</h1>
        {description && <p class="subtitle">{description}</p>}
      </header>
      <div class="prose">
        <slot />
      </div>
      <footer class="story-footer">
        {tags.length > 0 && (
          <div class="tags">
            {tags.map((tag: string) => (
              <span class="tag">#{tag}</span>
            ))}
          </div>
        )}
        <div class="share-story">
          <p>Know a dad who needs to hear this? Share it.</p>
          <a
            href={`https://x.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(Astro.url.href)}&via=DadEffect`}
            target="_blank"
            class="btn btn-secondary"
          >
            Share on ùïè
          </a>
        </div>
      </footer>
    </article>
  </div>
</BaseLayout>
